
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>2014 Fifa World Cup Brazil</title>
<meta name="keywords" content="" />
<meta name="description" content="2014 Fifa World Cup Brazil prediction model and visualization" />
<!-- <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900" rel="stylesheet" />
<link href="style/default.css" rel="stylesheet" type="text/css" media="all" />
<link href="style/fonts.css" rel="stylesheet" type="text/css" media="all" />
<link href="style/magnific-popup.css" rel="stylesheet">  -->
<link rel="image_src" href="http://andrewyuan.github.io/img/datavis3.png"/>
<!-- <meta name="twitter:image" content="http://andrewyuan.github.io/img/datavis3.png"/>
<meta name="twitter:image:width" content="1920"/>
<meta name="twitter:image:height" content="1080"/>
<meta property="og:image" content="http://andrewyuan.github.io/img/datavis3.png" /> -->

<script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
<!-- <script src="lib/jquery.magnific-popup.min.js?v=0.9.9"></script> -->

<!--[if IE 6]><link href="default_ie6.css" rel="stylesheet" type="text/css" /><![endif]-->

<style type="text/css">
      /* padding-bottom and top for image */
      .mfp-no-margins img.mfp-img {
        padding: 0;
      }
      /* position of shadow behind the image */
      .mfp-no-margins .mfp-figure:after {
        top: 0;
        bottom: 0;
      }
      /* padding for main container */
      .mfp-no-margins .mfp-container {
        padding: 0;
      }
      
      #tooltip {
        position: absolute;
        width: 200px;
        height: auto;
        padding: 10px;
        background-color: white;
        -webkit-border-radius: 10px;
        -moz-border-radius: 10px;
        border-radius: 10px;
        -webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
        -moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
        box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
        pointer-events: none;
      }

      #tooltip.hidden {
        display: none;
      }

      #tooltip p {
        margin: 0;
        font-family: sans-serif;
        font-size: 12px;
        line-height: 20px;
      }

</style>

</head>
<body>
<!-- <div id="header-wrapper">
  <div id="header" class="container">
    <div id="menu">
      <ul>
        <li><a href="index.html" accesskey="1" id="homepage">Homepage</a></li>
        <li><a href="index.html#aboutme" accesskey="2" id="aboutmeBtn">About Me</a></li>
        <li class="current_page_item"><a href="index.html#samplework" accesskey="3" id="sampleworkBtn">Sample Work</a></li>
        <li><a href="index.html#getintouch" accesskey="4" title="getintouchBtn">Get in Touch</a></li>
      </ul>
    </div>
  </div>
</div> -->
<br>
<div id="wrapper-FWC">
<!--   <div class="title">

    <center><H3><font color="white" size="6px">2014 Fifa World Cup Brazil predictions - And the Winner is...</font></H3>
    <font color="gray">powered by <font color="white">D3.js</font></font></center>
  </div> -->
  <br>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://d3js.org/topojson.v0.min.js"></script>
  <center><svg></svg></center>
<!--   <div class="footer">
    <center><br><p><font color="gray" size="2px">Visualization and numbers by <font color="white">Andrew Yuan</font> - check the estimation <a href="methodology.html" target="_blank"><font color="white">methodology</font><p><img src="img\datavis3.png" width="80" height="40" style="border:1px solid gray"></a></font></center>
  </div> -->
</div>





<script>


//==========================================================================================================//
//= Data Load                                                                                              =//
//==========================================================================================================//

  var data = {
    "nodes":[         
            {"node":"A1", "level":4, "position":1, "edge":"A1B2"},
            {"node":"A2", "level":4, "position":9, "edge":"A2B1"},
            {"node":"B1", "level":4, "position":10, "edge":"A2B1"},
            {"node":"B2", "level":4, "position":2, "edge":"A1B2"},
            {"node":"C1", "level":4, "position":3, "edge":"C1D2"},
            {"node":"C2", "level":4, "position":11, "edge":"C2D1"},
            {"node":"D1", "level":4, "position":12, "edge":"C2D1"},
            {"node":"D2", "level":4, "position":4, "edge":"C1D2"},
            {"node":"E1", "level":4, "position":13, "edge":"E1F2"},
            {"node":"E2", "level":4, "position":5, "edge":"E2F1"},
            {"node":"F1", "level":4, "position":6, "edge":"E2F1"},
            {"node":"F2", "level":4, "position":14, "edge":"E1F2"},
            {"node":"G1", "level":4, "position":15, "edge":"G1H2"},
            {"node":"G2", "level":4, "position":7, "edge":"G2H1"},
            {"node":"H1", "level":4, "position":8, "edge":"G2H1"},
            {"node":"H2", "level":4, "position":16, "edge":"G1H2"},
            {"node":"A1B2", "level":3, "position":1, "edge":"A1B2C1D2"},
            {"node":"C1D2", "level":3, "position":2, "edge":"A1B2C1D2"},
            {"node":"E1F2", "level":3, "position":7, "edge":"E1F2G1H2"},
            {"node":"G1H2", "level":3, "position":8, "edge":"E1F2G1H2"},
            {"node":"A2B1", "level":3, "position":5, "edge":"A2B1C2D1"},
            {"node":"C2D1", "level":3, "position":6, "edge":"A2B1C2D1"},
            {"node":"E2F1", "level":3, "position":3, "edge":"E2F1G2H1"},
            {"node":"G2H1", "level":3, "position":4, "edge":"E2F1G2H1"},
            {"node":"A1B2C1D2", "level":2, "position":1, "edge":"A1B2C1D2E1F2G1H2"},
            {"node":"A2B1C2D1", "level":2, "position":3, "edge":"A2B1C2D1E2F1G2H1"},
            {"node":"E1F2G1H2", "level":2, "position":4, "edge":"A1B2C1D2E1F2G1H2"},
            {"node":"E2F1G2H1", "level":2, "position":2, "edge":"A2B1C2D1E2F1G2H1"},
            {"node":"A1B2C1D2E1F2G1H2", "level":1, "position":1, "edge":"final"},
            {"node":"A2B1C2D1E2F1G2H1", "level":1, "position":2, "edge":"final"},
            {"node":"final", "level":0, "position":1, "edge":""},
    ],

    "groups": [
            {"label":"2nd of H","group":"H","node":"H2","position":16}, 
            {"label":"1st of G","group":"G","node":"G1","position":15}, 
            {"label":"2nd of F","group":"F","node":"F2","position":14}, 
            {"label":"1st of E","group":"E","node":"E1","position":13}, 
            {"label":"1st of D","group":"D","node":"D1","position":12}, 
            {"label":"2nd of C","group":"C","node":"C2","position":11}, 
            {"label":"1st of B","group":"B","node":"B1","position":10}, 
            {"label":"2nd of A","group":"A","node":"A2","position":9}, 
            {"label":"1st of H","group":"H","node":"H1","position":8}, 
            {"label":"2nd of G","group":"G","node":"G2","position":7}, 
            {"label":"1st of F","group":"F","node":"F1","position":6}, 
            {"label":"2nd of E","group":"E","node":"E2","position":5}, 
            {"label":"2nd of D","group":"D","node":"D2","position":4}, 
            {"label":"1st of C","group":"C","node":"C1","position":3}, 
            {"label":"2nd of B","group":"B","node":"B2","position":2}, 
            {"label":"1st of A","group":"A","node":"A1","position":1}, 
      ]
  }



//==========================================================================================================//
//= Setup                                                                                                  =//
//==========================================================================================================//



function colores_google(n) {
  var colores_g = ["#ff8000",
                   "#3366cc", 
                   "#dc3912", 
                   "#ff9900", 
                   "#109618",
                   "#aaaa11", 
                   "#990099", 
                   "#0099c6", 
                   "#dd4477", 
                   "#66aa00", 
                   "#b82e2e",                    
                   "#994499",                     
                   "#6633cc", 
                   "#e67300", 
                   "#8b0707", 
                   "#651067", 
                   "#329262",                   
                   "#316395", 
                   "#5574a6", 
                   "#3b3eac",
                   "#a8a8a8",
                   "#696969",
                   "#2a2a2a",
                   "#000000",
                   "#22aa99",
                   "#ff0000",
                   "#FFD700",
                   "#FFFF00",
                   "#00FF00",
                   "#0000FF",                  
                   "#00ffff",
                   "#ff0080"];
  return colores_g[n % colores_g.length];
}





  var margin = {top: 15, right: 10, bottom: 5, left: 100},
      width = 1800 - margin.left - margin.right,
      height = 900 - margin.top - margin.bottom;
  //    height = 533 - margin.top - margin.bottom;

  var color = {"background": "#444",
              "circleHome": "#9ECCFF",
              "circleAway": "#B96359",
              "circleNeutral": "white",
              "axis": "#eee",
              "text": "#fff",
              "line": "#888",
              "linetest": "#ff0000",
              "gray": "#666",
              "groupGray": {"A": "#333", "B": "#666", "C": "#555", "D": "#888", "E": "#777", "F": "#AAA", "G": "#999", "H": "#CCC"}, //grayscale
              "group": {"A": "#2A3A85", "B": "#FCD412", "C": "#61AA25", "D": "#DB2624", "E": "#0193D9", "F": "#F09D0C", "G": "#09621D", "H": "#86001A"}}; // Fifa Colors


// CIRCLE GRAPH
  var widthCircle = width/2
  var heightCircle = height
  // var cxCircle = 800
  // var cyCircle = heightCircle/2

  var cxCircle = widthCircle/2
  var cyCircle = heightCircle/2
  var levelsCircle = 6
  var rLevel = (cxCircle)/(levelsCircle)
  var radius = cxCircle
  // var radius = widthCircle/2

  var nodeAttr = {"fill": color.circleNeutral,
                  "stroke": color.line,
                  "r": 7,
                  "stroke-width": "3px",
                  "opacity": 1}

  var nodeHighlight = {"fill": "#7273B0",
                      "stroke": "black",
                      "stroke-width": "3px",
                      "r": 30}

  var probAttr = {"font-size": "18px",
                "font-style": "normal", 
                "font-weight": "bold",
                "fill": "white",
                "text-anchor": "middle",
                "vertical-align": "middle",
                "display": "none"}

  var probHighlight = {"display": "inline"}

                /*d3.select(this).attr("fill", function(d, i) {return color.circleNeutral});
                d3.select(this).attr("stroke", function(d, i) {return color.line});
                d3.select(this).attr("r", nodeRadius);*/

  var linkAttr = {"stroke": color.line,
                  "stroke-width": "2px",
                  "fill": "none"}


  var linkAttrtest = {"stroke": "#ff0000",
                      "stroke-width": "2px",
                      "fill": "black",
                      "color": "#ff0000",
                      "background": "#ff0000"}

  var linkHighlight = {"stroke": "#1659F5",
                  "stroke-width": "4px",
                  "fill": "none"}

  var posAdjust = 20;

  var colorScale = d3.scale.linear()
  .domain([1, 0.2, 0]) // values elevation (m)
  .range(["#ccc", "#aaa", "#333"]) // green to red
//  .range(["red", "#C3C959", "#97F597"]) // green to red
//  .range(["#A6ABDF", "#474159"]) // colors
  .interpolate(d3.interpolateHcl)




// // BAR CHART
//   var spacing = 150,
//       barLeft = widthCircle + spacing,
//       barRight = width - 50,
//       rankSpacing = 250,
//       barTop = margin.top,
//       barBottom = height/2 - rankSpacing,
//       barWidth = 15

//   var yBarScale = d3.scale.linear()
//       .domain([0, .25])
//       .rangeRound([barBottom, barTop]);

//   var xBarScale = d3.scale.linear()
//       .domain([1, 32])
//       .range([barLeft, barRight]);

//   var xRankScale = d3.scale.linear()
//       .domain([1, 60])
//       .range([barLeft - barWidth, barRight]);

// // MAP
//   var mapLeft = barLeft - spacing/2
//       mapRight = barRight + spacing/4
//       mapTop = barBottom + rankSpacing
//       mapBottom = height
//       cxMap = mapLeft + (mapRight - mapLeft)/2
//       cyMap = mapTop + (mapBottom - mapTop)/2


//   var rBubbleScale = d3.scale.linear()
//       .domain([0, 1])
//       .range([5, 50]);


// FRAME
  var svg = d3.select("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
    .append("g")
      // .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  svg.append("rect")
      .attr({
          "x": -margin.left,
          "y": -margin.top,
          "width": width + margin.left + margin.right,
          "height": height + margin.top + margin.bottom,
          "stroke": color.line,
          "stroke-width": .5,
          "fill": "#fff",
          "opacity": 1
      })

  // svg.append("line")
  //     .attr({
  //         "x1": widthCircle + spacing/4,
  //         "x2": widthCircle + spacing/4,
  //         "y1": margin.top,
  //         "y2": height - margin.bottom - margin.top,
  //         "stroke": color.line,
  //         "stroke-width": .5
  //     })

  // svg.append("line")
  //     .attr({
  //         "x1": widthCircle + spacing/2,
  //         "x2": width - margin.right,
  //         "y1": barBottom + rankSpacing + 40,
  //         "y2": barBottom + rankSpacing + 40,
  //         "stroke": color.line,
  //         "stroke-width": .5
  //     })

//==========================================================================================================//
//============================================= CIRCULAR ===================================================
//=============================================  GRAPH   ===================================================
//==========================================================================================================//

d3.json("teams.json",  function(error, teams) {

	  var year = 1998;
    //==========================================================================================================//
    //= Calculate nodes positions and rotation                                                                 =//
    //==========================================================================================================//

      var nodePosition = {}

      for (i in data.nodes) {
          node = data.nodes[i]
          if (node.level == 4) rotation = - 22.5 * node.position + 11.25;
          else if (node.level == 3) rotation = - 45 * node.position + 22.5;
          else if (node.level == 2) rotation = - 90 * node.position + 45;
          else if (node.level == 1) rotation = 180 * node.position - 180;
          r =  rLevel * node.level
          x = cxCircle + Math.sin(rotation * Math.PI / 180) * r 
          y = cyCircle - Math.cos(rotation * Math.PI / 180) * r
          nodePosition[node.node] = {'x': x, 'y': y, 'r': r, 'rotation': rotation}
      }

    //==========================================================================================================//
    //= Groups                                                                                                  =//
    //==========================================================================================================//

      var gGroups = svg.append("g")
              .attr("id", "groups")

      var arcBox = d3.svg.arc()
          .outerRadius(radius)
          .innerRadius(radius - 2* rLevel);

      var pie = d3.layout.pie()
          .sort(null)
          .value(function(d) { return 1; });

      var gGroupsBox = gGroups.selectAll(".arc")
          .data(pie(data.groups))
          .enter().append("g")
          .attr({
            "class": "arc",
            "transform": "translate(" + cxCircle + ", " + cyCircle + ")"});

      gGroupsBox.append("path")
          .attr({
            "d": arcBox,
            "fill": function(d) {return color.group[d.data.group]; },
            "opacity": .08,
            "stroke": "black",
            "stroke-width": "1px",
            "stroke-opacity": 10});

      // ARC BORDER - Transparency of 1st Arc makes borders transparent also
      gGroupsBox.append("path")
          .attr({
            "d": arcBox,
            //"fill": function(d) { return "#eee"; },
            "fill": "none",
            //"fill": 'black',
            "opacity": 1,
            "stroke": color.line,
            "stroke-width": "1px",
            "stroke-opacity": 1});


      // INNER and OUTER RINGS
      var arcInner = d3.svg.arc()
          .outerRadius(radius - 2* rLevel + rLevel/3)
          .innerRadius(radius - 2* rLevel);

      var gRings = gGroups.selectAll(".arcInner")
          .data(pie(data.groups))
          .enter().append("g")
          .attr({
            "class": "arcInner",
            "transform": "translate(" + cxCircle + ", " + cyCircle + ")"});

      gRings.append("path")
          .attr({
            "id": function(d) {return d.data.node},
            "class": function(d) {return d.data.group},
            "d": arcInner,
            "fill": function(d) {return color.gray; },
            //"fill": function(d) {return color.groupGray[d.data.group]; },
            "opacity": 1,
            //"stroke": 'black',
            "stroke": color.line,
            "stroke-width": "1px"});

      var arcOuterRing = d3.svg.arc()
          .outerRadius(radius)
          .innerRadius(radius - 5);

      gRings.append("path")
          .attr({
            "id": function(d) {return d.data.node},
            "class": function(d) {return d.data.group},
            "d": arcOuterRing,
            "fill": function(d) {return color.gray; },
            //"fill": function(d) {return color.groupGray[d.data.group]; },
            "opacity": 1,
            "stroke": color.line,
            "stroke-width": "1px"});


      // LABELS
      var gLabel = gGroups.selectAll(".arcLabel")
          .data(data.groups)
          .enter().append("g")
          .attr({
            "class": "arcLabel"});

      gLabel.append("text")
          .attr({
            "x": function(d) { return cxCircle; },
            "y": function(d) { 
                              rotation = nodePosition[d.node].rotation;
                              //console.log(rotation)
                              //console.log(d)
                              if (-270 < rotation && rotation < -90) return cyCircle + rLevel * 4 + rLevel/4
                              else return cyCircle - rLevel * 4 - rLevel/16},
            // "x": 10,
            // "y": 10,
            "font-size": "20px",
            "font-style": "normal", 
            "font-weight": "bold",
            "fill": function(d) { return "white"; },
            "text-anchor": "middle",
            "transform": function(d, i) {
                              rotation = nodePosition[d.node].rotation;
                              if (-270 < rotation && rotation < -90) rotation = rotation + 180;
                              return "rotate(" + rotation + " " + cxCircle + " " + cyCircle + ")";}
          })
          .text(function(d) { return d.label; });



    //==========================================================================================================//
    //= Teams                                                                                                  =//
    //==========================================================================================================//



      var gTeams = svg.append("g")
              .attr("id", "barchart")

      var gTeamsNames = gTeams.selectAll("#teams")
              .data(teams[year])
              .enter().append("g")
              .attr("id", "teams")

      //console.log(gTeamsNames)

      var gTeamsNamestext = gTeamsNames.append("text")
              .text(function(d) { return d.name; })
              .attr({
                // "id": function(d) { return d.abrev + d.node},
                // "class": function(d) { return d.abrev },
                "id": function(d) {return d.abrev + d.node},
                "class": function(d) { return "team" },
                "x": function(d) { 
                    if (d.position <= 32) return 2*rLevel - rLevel/2;
                    else return (2*radius)-(2*rLevel - rLevel/2)},
                "y": function(d) { return cyCircle; },
                "font-size": "18px",
                "font-style": "normal", 
                "font-weight": "normal",
                "fill": function(d) { return color.text; },
                "text-anchor": function(d) {
                    if (d.position <= 32) return "end";
                    else return "start"},
                "transform": function(d, i) { 
                    if (d.position <= 32) rotation = - 5.625 * (d.position) + 92;
                    else rotation = - 5.625 * (d.position-32) + 94;
                    return "rotate(" + rotation + " " + cxCircle + " " + cyCircle + ")"; 
                  }})
              .attr("stroke-width","2px")
              .attr("stroke","red")
              .each(function(d,i) {


              	var colortext = function(name, group, color){
              		d3.select("text#"+name+group+".team").attr("stroke",color)

                }

              	var rank = d.rank
              	var name = d.abrev
              	var group12 = d.node

              	colortext(name, group12, colores_google(rank))

              })

        //console.log(gTeamsNamestext[0])

        //d3.select("text#DZH1.DZ").attr("stroke","black")






        


        
                // .attr('color', function(d){

                //   d.nodes.forEach(function (d, i) {

                //     edge = gLinks.select("path.link#" + d.node)
                //     edge = gLinks.select("path.link#" + nodes[i].node)
                //     if (d.node == "A1") {
                //       edge.attr(linkAttrtest)
                //     }else{
                //       edge.attr(linkHighlight)
                //     }

                //   })

                

                // })
              // .on("mouseover", function(d){


              //       //console.log(d.nodes)
              //       d.nodes.forEach(function (d, i) {


              //                         //console.log(i)
              //                         node = gNodes.select("circle#" + d.node)
              //                         node.transition().delay(0).duration(100)
              //                             .attr(nodeHighlight)
              //                             .attr('fill', colorScale(d.probability));
              //                         prob = gNodes.select("text#" + d.node)
              //                         prob.attr(probHighlight);
              //                         prob.text(parseFloat(d.probability*100).toFixed(1) + '%')

              //                         //console.log(d.node)


              //                         edge = gLinks.select("path.link" + d.node)
              //                         // edge = gLinks.select("path.link#A1")
              //                         // edge.attr(linkAttrtest)
              //                         if (d.node == "A1") {
              //                           edge.attr(linkAttrtest)
              //                         }else{
              //                           edge.attr(linkHighlight)
              //                         }
                                      
                                      
              //       })
              //       d3.selectAll("." + d.group).attr("fill", color.group[d.group])
              //       d3.selectAll("text." + d.abrev) .attr({"fill": "#1659F5"});
              //       gRankTeams.selectAll("#" + d.abrev).attr('stroke', '#1659F5')
              //       gMapBubble.selectAll("#" + d.abrev).attr('fill', '#1659F5')
              // })
              // .on("mouseout", function(d){
              //       d.nodes.forEach(function (d, i) {
              //                         node = gNodes.select("#" + d.node)
              //                         node.transition().delay(100).duration(100).attr(nodeAttr)
              //                         prob = gNodes.select("text#" + d.node)
              //                         prob.attr(probAttr);
              //                         edge = gLinks.select("path#" + d.node)
              //                         edge.attr(linkAttr)
              //       })
              //       resetCharts()
              // })


    // //==========================================================================================================//
    // //= Teams probability label                                                                                =//
    // //==========================================================================================================//

    //   var gTeamsProb = gTeamsNames.append("g")
    //           .attr("id", "teamsProb")

    //     gTeamsProb.append("text")
    //           .text("")
    //           .attr({
    //             "id": function(d) { return d.name + d.node}, 
    //             "x": function(d) { 
    //                 if (d.position <= 32) return 2*rLevel+5;
    //                 else return (2*radius)-(2*rLevel+5)},
    //             "y": function(d) { return cyCircle; },
    //             "font-size": "18px",
    //             "font-style": "normal", 
    //             "font-weight": "bold",
    //             "display": "normal",
    //             "fill": function(d) { return colorScale(0); },
    //             "text-anchor": function(d) {
    //                 if (d.position <= 32) return "start";
    //                 else return "end"},
    //             "transform": function(d, i) { 
    //                 if (d.position <= 32) rotation = - 5.625 * (d.position) + 92;
    //                 else rotation = - 5.625 * (d.position-32) + 94;
    //                 return "rotate(" + rotation + " " + cxCircle + " " + cyCircle + ")"; }})


    //==========================================================================================================//
    //= Edges                                                                                                  =//
    //==========================================================================================================//

      path = function(d) {
          var curvature = .4;

          origin = d.node
          destiny = d.edge
          origX = nodePosition[origin].x
          origY = nodePosition[origin].y
          origR = nodePosition[origin].r
          origRot = nodePosition[origin].rotation

          destX = nodePosition[destiny].x
          destY = nodePosition[destiny].y
          destR = nodePosition[destiny].r
          destRot = nodePosition[destiny].rotation

          var x0 = origX,
              y0 = origY,
              x1 = cxCircle + Math.sin(origRot * Math.PI / 180) * (origR - rLevel * curvature),
              y1 = cyCircle - Math.cos(origRot * Math.PI / 180) * (origR - rLevel * curvature),
              x2 = cxCircle + Math.sin(destRot * Math.PI / 180) * (destR + rLevel * curvature),
              y2 = cyCircle - Math.cos(destRot * Math.PI / 180) * (destR + rLevel * curvature),
              x3 = destX,
              y3 = destY

          return "M" + x0 + "," + y0
               + "L" + x1 + "," + y1
               + "L" + x2 + "," + y2
               + "L" + x3 + "," + y3;

      }
      
      var gLinks = svg.append("g")
              .attr("id", "link")

      // gLinks.select("path.link#A1")
      //         .attr(linkAttrtest)



      // var findpath = function (node){
      //   nodes = data.nodes.slice(0, data.nodes.length-1)
      //   for (var i in nodes) {
      //     if (nodes[i].node == node) return nodes[i].node
      //   }
      // };

      // var findpath = function (node){
      //   nodes = data.nodes.slice(0, data.nodes.length-1)
      //   for (var i in nodes) {
      //     if (nodes[i].node == node){

      //       //console.log(nodes[i].node)

      //       edge = gLinks.select("path.link#" + nodes[i].node)



      //       edge.attr(linkAttrtest)




      //     }

      //   }
      // };



      // findpath("A1B2");


      // edge = gLinks.select("path.link#A1")
      // edge.attr(linkAttrtest)








      //console.log(findpath("A1"))

      // edge = gLinks.select("path.link#" + findpath('A1'))
      // edge.attr(linkAttrtest)


      //console.log(data.nodes.slice(0, data.nodes.length-1))

      var link = gLinks.selectAll(".link")
              .data(data.nodes.slice(0, data.nodes.length-1))
              .enter().append("path")
              .attr({"class": "link",
                    "id": function(d) {return d.node},
                    "d": path})
              // .attr(linkAttr)
              .attr("fill","none")
              .attr("stroke-width","5px")
              .attr("stroke","gray")


      //console.log(gTeamsNamestext)





              // .attr("stroke",function(d){
              // 	if (d.node == "A1") {
              //     return "red"
              //   }else{
              //     return "blue"
              //   }


              // })



              // .attr("stroke",function(d){
              // 	if (d.node == "A1"){
              // 		return "red"
              // 	}else{
              // 		return "blue"
              // 	}
              // })
              // .attr("stroke",function(d){
              //   if (d.node == "A1" || d.node == "A1B2") {
              //     return "red"
              //   }else{
              //   	if (d.node == "B2") {
              //   		return "green"
              //   	}else{
              //   		return "blue"
              //   	}
                	
              //   }

              // })
              // .attr("path.link#B2", "")


        //console.log(gLinks.selectAll('.link')[0])

        //console.log(link.selectAll('.link')[0].parentNode.id)

        //console.log(link.selectAll('.link'))
        
        d3.selection.prototype.moveToFront = function()
        {
        	return this.each(function(){
        		this.parentNode.appendChild(this);
        	});
        };

        //console.log(link.selectAll(".link")[0].parentNode)


        // pathtest = link.selectAll(".link")[0].parentNode
        // pathtest.attr("stroke","red")

        //d3.select("path#A1.link").moveToFront().attr("stroke","red")




        teamdata = teams[year]


        edge2 = ["A1B2","A2B1","C1D2","C2D1","E1F2","E2F1","G1H2","G2H1"]
        edge3 = ["A1B2C1D2","E1F2G1H2","A2B1C2D1","E2F1G2H1"]
        edge4 = ["A1B2C1D2E1F2G1H2","A2B1C2D1E2F1G2H1"]



        var paintedge = function(){

        	var coloredge = function(name, color){
        		d3.select("path#"+name+".link").moveToFront().attr("stroke",color)
        	}

            var selectnode = function(node,edgelist){
            	//console.log(node)

            	var result

            	edgelist.forEach(function(d, i) {
            		//console.log(d)
            		// console.log(d.includes(node))
            		if (d.includes(node) == true){

            			//console.log(d)
            			result = d


            		}
            	})


            	//console.log(result)

            	return result

            }




        	teamdata.forEach(function(d, i) {

        		//console.log(d)
        		if (d.level == '4'){
        			coloredge(d.startnode,colores_google(d.rank))
        		}



        	})

        	teamdata.forEach(function(d, i) {

        		//console.log(d)


        		if (d.level == '3'){
        			coloredge(d.startnode,colores_google(d.rank))
        			// console.log(d.startnode)
        			// console.log(edge2)
        			//console.log(selectnode(d.startnode,edge2))
        			coloredge(selectnode(d.startnode,edge2),colores_google(d.rank))


        		}



        	})

 
        	teamdata.forEach(function(d, i) {

        		//console.log(d)


        		if (d.level == '2'){
        			coloredge(d.startnode,colores_google(d.rank))
        			coloredge(selectnode(d.startnode,edge2),colores_google(d.rank))
        			coloredge(selectnode(d.startnode,edge3),colores_google(d.rank))


        		}




        	})

        	teamdata.forEach(function(d, i) {

        		//console.log(d)


        		if (d.level == '1'){
        			coloredge(d.startnode,colores_google(d.rank))
        			coloredge(selectnode(d.startnode,edge2),colores_google(d.rank))
        			coloredge(selectnode(d.startnode,edge3),colores_google(d.rank))
        			coloredge(selectnode(d.startnode,edge4),colores_google(d.rank))


        		}


        	})        	      


        	teamdata.forEach(function(d, i) {

        		//console.log(d)


        		if (d.level == '0'){
        			coloredge(d.startnode,colores_google(d.rank))
        			coloredge(selectnode(d.startnode,edge2),colores_google(d.rank))
        			coloredge(selectnode(d.startnode,edge3),colores_google(d.rank))
        			coloredge(selectnode(d.startnode,edge4),colores_google(d.rank))

        			


        		}


        	}) 


        }

        paintedge()

        //d3.select("path#"+"A2B1C2D1"+".link").moveToFront().attr("stroke","black")


        //console.log("A1B2".match(/A1/))
        //console.log("A2B1C2D1".includes("A2"))

        // coloredge("A1","green")
        // coloredge("A1B2","green")
        // coloredge("A1B2C1D2","green")
        // coloredge("A1B2C1D2E1F2G1H2","green")
        // coloredge("A2B1C2D1E2F1G2H1",colores_google(3))


        // link.selectAll('.link').filter(function(d){

        // 	return link.select(d).data()


        // 	console.log(d.parentNode)
        // })





        // var seltest = glinks.select(".link", function(d){
        // 	if (d.node == "A1") {
        // 		return true
        // 	}
                      



      // var link2 = gLinks.selectAll(".link")
      //         .data(findpath("A1"))
      //         .enter().append("path")
      //         .attr({"class": "linktest",
      //               "id": function(d) {return d.node},
      //               "d": path})
      //         .attr(linkAttr)



    //==========================================================================================================//
    //= Nodes                                                                                                  =//
    //==========================================================================================================//

      var gNodes = svg.append("g")
              .attr("id", "nodes")

      var gNodesCircle = gNodes.selectAll(".circle")
              .data(data.nodes)
              .enter()
              .append("circle")
              .attr({
                "id": function(d) { return d.node; },



                "cx": function(d) { return cxCircle; },
                "cy": function(d) { return cyCircle - (rLevel * d.level); }})
              .attr("transform", function(d, i) { 

                                      rotation = nodePosition[d.node].rotation
                                      d.rotation = rotation
                                      return "rotate(" + rotation + " " + cxCircle + " " + cyCircle + ")"; })
               .attr(nodeAttr)


      //console.log(gNodesCircle[0][30])


      var colorcircle = function(color){
            	d3.select("circle#final").attr({"fill": color,
                                                "stroke": color.line,
                                                "r": 15,
                                                "stroke-width": "3px",
                                                "opacity": 1})


       }   



       teamdata.forEach(function(d, i) {

        		//console.log(d)
        		if (d.level == '0'){
        			colorcircle(colores_google(d.rank))
        		}



        	})

      


              // .on("mouseover", function(d){
              //       d3.select(this).attr('fill', '#1659F5');
              //       node = d.node;
              //       gMapBubble.selectAll("circle").attr({"r": 0})

              //       gTeamsProb.selectAll("text")
              //           .text(function(d, i){
              //               if (node.indexOf(d.node) >= 0 || node == "final"){
              //                 for (var i in d.nodes) {
              //                     if (d.nodes[i].node == node){
              //                       d.probability = d.nodes[i].probability
              //                       d3.selectAll("." + d.group + "#" + d.node).attr("fill", color.group[d.group])
              //                       gBarTeams.selectAll("." + d.group).attr("fill", color.group[d.group])
              //                       d3.selectAll("text#" + d.abrev + d.node) .attr("fill", "#1659F5");
              //                       d3.selectAll("text#" + d.abrev) .attr("fill", "#1659F5");
              //                       gRankTeams.selectAll("#" + d.abrev).attr('stroke', '#1659F5')
              //                       gMapBubble.selectAll("#" + d.abrev).attr('fill', '#1659F5')

              //                       gMapBubble.selectAll("#" + d.abrev)
              //                         .transition()
              //                         .duration(500)
              //                         .attr({"r": rBubbleScale(Math.sqrt(d.probability))})

              //                       return parseFloat(d.probability*100).toFixed(1) + '%';
              //                     }
              //                 }
              //               }
              //           })
              //           .attr({
              //             "fill": function(d){return colorScale(d.probability)}
              //           })
              // })
              // .on("mouseout", function(d){
              //       d3.select(this).attr(nodeAttr)
              //       resetCharts()
              // })
              // .transition()
              // .delay(function(d, i) { return (d.level*200);})
              // .duration(1000)


      // gNodes.selectAll(".probability")
      //         .data(data.nodes)
      //         .enter().append("text")
      //         .text('100%')
      //         .attr({
      //           "id": function(d) { return d.node; },
      //           "x": function(d) { return nodePosition[d.node].x; },
      //           "y": function(d) { return nodePosition[d.node].y + 6; }})
      //         .attr(probAttr)



//==========================================================================================================//
//============================================  FUNCTIONS  =================================================
//==========================================================================================================//

  function resetCharts() {

      gTeamsProb.selectAll("text").text("")
      gRings.selectAll("path").attr("fill", color.gray)
      gTeamsNames.selectAll("text").attr("fill", color.text);
      gBarTeams.selectAll("text").attr("fill", color.text);
      gBarTeams.selectAll("rect")
              .attr("fill", color.gray)
/*              .transition()
              .duration(750)
              .attr({
                "y": function(d) {
                    for (var i in d.nodes) {
                        if (d.nodes[i].node == "final"){
                            d.probability = d.nodes[i].probability
                        }
                    }
                    return yBarScale(d.probability)},
                "height": function(d) {return yBarScale(0)-yBarScale(d.probability)}
              })
*/

      gRankTeams.selectAll("path").attr('stroke', 'gray')
      gRankTeams.selectAll("circle").attr('stroke', 'gray')
      gMapBubble.selectAll("circle").attr({
              'fill': 'red',
              "r": 0
        })
        .transition()
        .duration(0)
        .attr({"r": function(d) { 
                      for (var i in d.nodes) {
                          if (d.nodes[i].node == "final"){
                              d.probability = d.nodes[i].probability
                          }
                      }
                      return rBubbleScale(Math.sqrt(d.probability))},
        })
  }







});

</script>
      
    </div>
  </div>
</div>

<!-- <div id="contact">
  <div class="title">
    <h2><A NAME="getintouch">Get in touch</A></h2>
    <span class="byline">I will be glad to hear from you!</span> </div>
  <ul class="contact">
    <li><a href="https://www.facebook.com/andrew.yuan.9" class="icon icon-facebook"><span></span></a></li>
    <li><a href="https://www.linkedin.com/in/andrewgky" class="icon icon-linkedin"><span>LinkedIn</span></a></li>
    <li><a href="https://plus.google.com/u/0/+AndrewYuanGK" class="icon icon-google-plus"><span>Google+</span></a></li>
    <li><a href="https://twitter.com/AndrewGKYuan" class="icon icon-twitter"><span>Twitter</span></a></li>
    <li><a href="https://github.com/andrewyuan" class="icon icon-github"><span>Github</span></a></li>
    <li><a href="mailto:andrew.gk.yuan@gmail.com" class="icon icon-envelope"><span>Gmail</span></a></li>
  </ul>
  <p>Copyright (c) 2014 Andrew Yuan | Photos by <a href="#">Me</a> | Design by <a href="http://www.freecsstemplates.org/" rel="nofollow">CSS Templates</a>.</p>
</div> -->
</body>
<!-- <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-50045474-1', 'andrewyuan.github.io');
  ga('send', 'pageview');

</script> -->
</html>
